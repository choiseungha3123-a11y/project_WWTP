# Improved Baseline V2 - WWTP Prediction

## ğŸ“‹ ê°œìš”

V1 ëª¨ë¸ì˜ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ 3ê°€ì§€ ì£¼ìš” ê°œì„ ì‚¬í•­ì„ ì ìš©í•œ ë²„ì „ì…ë‹ˆë‹¤.

## ğŸ¯ V1ì˜ ì£¼ìš” ë¬¸ì œì 

1. **ë°ì´í„° ì†ì‹¤ 95.8%**: 13,848ê°œ â†’ 576ê°œ ìƒ˜í”Œë§Œ ì‚¬ìš©
2. **ì‹¬ê°í•œ ê³¼ì í•©**: Train RÂ² 0.97 â†’ Test RÂ² -1.31
3. **í”¼ì²˜ ë¶€ì¡±**: ìˆ˜ì§ˆ ë³€ìˆ˜ ì˜ˆì¸¡ì— í•„ìš”í•œ ë„ë©”ì¸ í”¼ì²˜ ë¶€ì¡±

## âœ¨ V2 ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. ê²°ì¸¡ì¹˜ ë³´ê°„ (Imputation)

**V1 ë°©ì‹**: `dropna()` - ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ ì „ì²´ ì œê±°
```python
# V1: 95.8% ë°ì´í„° ì†ì‹¤
keep = X.notna().all(axis=1) & y.notna().all(axis=1)
```

**V2 ë°©ì‹**: ì „ì²˜ë¦¬ ê³¼ì •ì—ì„œì˜ ë³´ê°„ ì „ëµ
```python
# V2: 3ë‹¨ê³„ ë³´ê°„
1. 1ë¶„ ê°„ê²©ì¸ì§€ í™•ì¸

2. ì„ í˜• ë³´ê°„ (ì‹œê³„ì—´ ì—°ì†ì„± ìœ ì§€)

```

### 2. ë„ë©”ì¸ í”¼ì²˜ ì¶”ê°€

**V1**: ê¸°ë³¸ ì‹œê³„ì—´ í”¼ì²˜ë§Œ (ì‹œê°„, lag, rolling)

**V2**: 5ê°€ì§€ ì¹´í…Œê³ ë¦¬ì˜ ë„ë©”ì¸ í”¼ì²˜ ì¶”ê°€

#### 2.1 ê°•ìˆ˜ëŸ‰ ê´€ë ¨
```python
rain_intensity = RN_60m / (RN_DAY + 1)  # ê°•ìˆ˜ ê°•ë„
is_raining = (RN_60m > 0).astype(int)   # ê°•ìˆ˜ ì—¬ë¶€
```

#### 2.2 ì˜¨ë„-ìŠµë„ ê´€ë ¨
```python
temp_humidity_idx = TA * HM / 100       # ë¶ˆì¾Œì§€ìˆ˜ ê·¼ì‚¬
temp_range = TA.rolling(24).max() - TA.rolling(24).min()
```

#### 2.3 íƒ±í¬ ìˆ˜ìœ„ ê´€ë ¨
```python
tank_total_level = level_TankA + level_TankB
tank_level_diff = abs(level_TankA - level_TankB)
tank_level_ratio = level_TankA / (level_TankB + 0.01)
```

#### 2.4 ìˆ˜ì§ˆ ë³€ìˆ˜ ìƒí˜¸ì‘ìš©
```python
TOC_TN_ratio = TOC_VU / (TN_VU + 0.01)  # ìœ ê¸°ë¬¼/ì§ˆì†Œ ë¹„ìœ¨
SS_TP_ratio = SS_VU / (TP_VU + 0.01)    # ë¶€ìœ ë¬¼ì§ˆ/ì¸ ë¹„ìœ¨
```

#### 2.5 ì°¨ë¶„ í”¼ì²˜ (ë³€í™”ìœ¨)
```python
TA_diff1 = TA.diff(1)    # 1ì‹œê°„ ë³€í™”
TA_diff24 = TA.diff(24)  # 24ì‹œê°„ ë³€í™”
```

### 3. ì •ê·œí™” ê°•í™”

#### 3.1 Ridge ì •ê·œí™”
```python
# V1
'alpha': [0.1, 1.0, 10.0, 100.0]

# V2
'alpha': [100, 1000, 10000]  # 10ë°° ì¦ê°€
```

#### 3.2 Lasso ì •ê·œí™”
```python
# V1
'alpha': [0.001, 0.01, 0.1, 1.0]

# V2
'alpha': [1.0, 10.0, 100.0]  # 100ë°° ì¦ê°€
```

#### 3.3 RandomForest ì œì•½
```python
# V1
'max_depth': [10, 20, None]  # Noneì€ ê³¼ì í•© ìœ ë°œ

# V2
'max_depth': [5, 10, 15]           # None ì œê±°
'min_samples_leaf': [5, 10, 20]    # ì¶”ê°€
```

#### 3.4 XGBoost ì •ê·œí™”
```python
# V2 ì¶”ê°€ íŒŒë¼ë¯¸í„°
'min_child_weight': [3, 5, 7]  # ë¦¬í”„ ë…¸ë“œ ìµœì†Œ ê°€ì¤‘ì¹˜
'gamma': [0, 0.1, 0.2]         # ë¶„í•  ìµœì†Œ ì†ì‹¤ ê°ì†Œ
```

#### 3.5 HistGBR ì œì•½
```python
# V2
'max_depth': [5, 10]              # V1: [5, 10, 20]
'min_samples_leaf': [20, 30]      # ì¶”ê°€
```

### 4. í”¼ì²˜ ìˆ˜ ê°ì†Œ

```python
# V1
n_top_features = 50  # FLOW: 30, TMS: 40, ALL: 50

# V2
n_top_features = 30  # FLOW: 25, TMS: 30, ALL: 35
```

**ì´ìœ **: 576ê°œ ìƒ˜í”Œì— 50ê°œ í”¼ì²˜ëŠ” ê³¼ì í•© ìœ ë°œ (ì°¨ì›ì˜ ì €ì£¼)

### 5. Lag/Rolling ìœˆë„ìš° ì¶•ì†Œ

```python
# V1
lag_hours = [1, 3, 6, 12, 24]
roll_hours = [3, 12, 24]

# V2
lag_hours = [1, 3, 6, 12]      # 24 ì œê±°
roll_hours = [3, 6, 12]        # ë” ì§§ì€ ìœˆë„ìš°
```

**ì´ìœ **: 24ì‹œê°„ lagëŠ” ê²°ì¸¡ì¹˜ ì¦ê°€ ë° ê³¼ì í•© ìœ ë°œ

## ğŸ“Š ì‹¤í–‰ ë°©ë²•

### ë°©ë²• 1: ì§ì ‘ ì‹¤í–‰
```bash
cd notebook/ML/improved/v2
python improved_v2_baseline.py
```

## ğŸ“ ê²°ê³¼ ì €ì¥ ìœ„ì¹˜

```
results/
â”œâ”€â”€ ML/v1          # V1 ê²°ê³¼
â”‚   â”œâ”€â”€ flow_r2_comparison.png
â”‚   â”œâ”€â”€ tms_r2_comparison.png
â”‚   â””â”€â”€ all_r2_comparison.png
â”‚
â””â”€â”€ ML/v2       # V2 ê²°ê³¼ (ìƒˆë¡œ ìƒì„±)
    â”œâ”€â”€ flow_r2_comparison.png
    â”œâ”€â”€ tms_r2_comparison.png
    â””â”€â”€ all_r2_comparison.png
```

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

### ë°ì´í„° ì‚¬ìš©ë¥  ì¦ê°€

### ì˜ˆì¸¡ ì„±ëŠ¥ (RÂ²)
```
FLOW (Q_in):
  V1: 0.57 â†’ V2: 0.75+ ëª©í‘œ

TMS í‰ê· :
  V1: -1.82 â†’ V2: 0.50+ ëª©í‘œ

ê³¼ì í•© ê°ì†Œ:
  V1: Train 0.97 / Test -1.31 (ê²©ì°¨ 2.28)
  V2: Train 0.70 / Test 0.50 (ê²©ì°¨ 0.20) ëª©í‘œ
```

## ğŸ” V1 vs V2 ë¹„êµ í¬ì¸íŠ¸

### 1. ë°ì´í„° ì‚¬ìš©ë¥ 
- V1: "Original samples: 13,848, After dropna: 576 (4.2%)"
- V2: "ë³´ê°„ í›„ ë‚¨ì€ ê²°ì¸¡ì¹˜: X / Y (Z%)" í™•ì¸

### 2. ê³¼ì í•© ì •ë„
- V1: Train RÂ² 0.97 â†’ Test RÂ² -1.31
- V2: Train-Test ê²©ì°¨ ê°ì†Œ í™•ì¸

### 3. TMS ì˜ˆì¸¡ ì„±ëŠ¥
- V1: ëª¨ë“  ëª¨ë¸ RÂ² < 0 (ì˜ˆì¸¡ ë¶ˆê°€)
- V2: RÂ² > 0 ë‹¬ì„± ì—¬ë¶€ í™•ì¸

### 4. í”¼ì²˜ ì¤‘ìš”ë„
- V1: ê¸°ìƒ ë°ì´í„° ìœ„ì£¼
- V2: ë„ë©”ì¸ í”¼ì²˜ (ë¹„ìœ¨, ìƒí˜¸ì‘ìš©) ì¤‘ìš”ë„ í™•ì¸

## ğŸ“ ì£¼ìš” íŒŒì¼

- `improved_v2_baseline.py`: V2 ë©”ì¸ ì½”ë“œ
- `README_v2.md`: ì´ ë¬¸ì„œ
- `README_v1.md`: V1 ë¬¸ì„œ

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

V2 ì‹¤í–‰ í›„ ê²°ê³¼ ë¶„ì„:
1. ë°ì´í„° ì‚¬ìš©ë¥  ì¦ê°€ í™•ì¸
2. ê³¼ì í•© ê°ì†Œ í™•ì¸
3. TMS ì˜ˆì¸¡ ì„±ëŠ¥ ê°œì„  í™•ì¸
4. í•„ìš”ì‹œ ì¶”ê°€ íŠœë‹:
   - ë³´ê°„ ë°©ë²• ë³€ê²½ (linear, knn, hybrid)
   - ì •ê·œí™” íŒŒë¼ë¯¸í„° ì¡°ì •
   - ë„ë©”ì¸ í”¼ì²˜ ì¶”ê°€/ì œê±°

## ğŸ“ ë¬¸ì˜

V2 ì‹¤í–‰ ê²°ê³¼ë¥¼ V1ê³¼ ë¹„êµí•˜ì—¬ ê°œì„  íš¨ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!
