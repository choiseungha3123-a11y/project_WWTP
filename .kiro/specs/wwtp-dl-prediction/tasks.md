# 구현 계획: 하수처리장 딥러닝 예측 시스템

## 개요

본 구현 계획은 LSTM 기반 딥러닝 모델을 사용하여 하수처리장의 유입유량과 수질 지표를 예측하는 시스템을 구축합니다. 각 작업은 이전 단계를 기반으로 하며, 점진적으로 기능을 추가하여 최종적으로 완전한 예측 시스템을 완성합니다.

## 작업 목록

- [x] 1. 프로젝트 구조 및 기본 유틸리티 설정
  - `python/notebook/DL/` 디렉토리 구조 생성
  - 필요한 디렉토리 생성: `python/model/`, `python/results/DL/`
  - 공통 설정 파일 작성 (하이퍼파라미터, 경로 등)
  - _요구사항: 1.2, 1.3, 1.4, 6.5, 10.4_

- [ ] 2. 데이터 로더 구현
  - [ ] 2.1 DataLoader 클래스 구현
    - CSV 파일 로딩 메서드 작성
    - 타임스탬프 파싱 기능 추가
    - 컬럼 검증 메서드 구현
    - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.6_
  
  - [ ]* 2.2 데이터 로더 속성 테스트 작성
    - **Property 1: 데이터 로딩 일관성**
    - **검증: 요구사항 1.1**
  
  - [ ]* 2.3 데이터 로더 단위 테스트 작성
    - 특정 파일 경로 로딩 테스트
    - 누락된 파일 오류 처리 테스트
    - 누락된 컬럼 오류 처리 테스트
    - _요구사항: 1.5, 14.1, 14.2_

- [ ] 3. 전처리 및 스케일러 관리 구현
  - [ ] 3.1 Preprocessor 클래스 구현
    - StandardScaler 래퍼 메서드 작성
    - NaN/무한값 검사 기능 추가
    - 스케일러 저장/로드 기능 구현
    - _요구사항: 2.6, 12.4, 14.5_
  
  - [ ]* 3.2 전처리 속성 테스트 작성
    - **Property 7: 정규화 속성**
    - **검증: 요구사항 2.6**
    - **Property 12: 스케일 역변환 라운드트립**
    - **검증: 요구사항 7.6**
  
  - [ ]* 3.3 전처리 단위 테스트 작성
    - 스케일러 저장/로드 테스트
    - NaN/무한값 검출 테스트
    - _요구사항: 14.5_

- [ ] 4. 슬라이딩 윈도우 데이터셋 구현
  - [ ] 4.1 TimeSeriesDataset 클래스 구현
    - PyTorch Dataset 인터페이스 구현
    - `__getitem__` 및 `__len__` 메서드 작성
    - _요구사항: 2.1, 2.2, 2.3_
  
  - [ ] 4.2 DatasetBuilder 클래스 구현
    - 슬라이딩 윈도우 시퀀스 생성 메서드
    - 시계열 데이터 분할 메서드 (train/val/test)
    - _요구사항: 2.1, 2.4, 2.5, 3.1, 3.2, 3.4, 3.5_
  
  - [ ]* 4.3 데이터셋 속성 테스트 작성
    - **Property 4: 슬라이딩 윈도우 시퀀스 형태**
    - **검증: 요구사항 2.1, 2.2, 2.4**
    - **Property 5: 시퀀스-타겟 쌍 일관성**
    - **검증: 요구사항 2.3**
    - **Property 6: 시간적 순서 보존**
    - **검증: 요구사항 2.5**
  
  - [ ]* 4.4 데이터 분할 속성 테스트 작성
    - **Property 8: 시간적 분할 무결성**
    - **검증: 요구사항 3.1, 3.3, 3.4, 3.5**
    - **Property 9: 분할 비율 정확성**
    - **검증: 요구사항 3.2**

- [ ] 5. 체크포인트 - 데이터 파이프라인 검증
  - 모든 테스트가 통과하는지 확인
  - 전처리된 데이터로 시퀀스 생성 테스트
  - 질문이 있으면 사용자에게 문의

- [ ] 6. LSTM 모델 아키텍처 구현
  - [ ] 6.1 LSTMModel 클래스 구현
    - PyTorch nn.Module 상속
    - LSTM 레이어 및 드롭아웃 구성
    - Fully Connected 출력 레이어 추가
    - forward 메서드 구현
    - _요구사항: 4.1, 4.2, 4.3, 4.4, 4.5, 4.7_
  
  - [ ]* 6.2 모델 아키텍처 단위 테스트 작성
    - 모델 초기화 테스트
    - 다양한 하이퍼파라미터 조합 테스트
    - forward pass 형태 검증
    - _요구사항: 4.6_
  
  - [ ]* 6.3 모델 속성 테스트 작성
    - **Property 10: 모델 입력 차원 처리**
    - **검증: 요구사항 4.1, 4.5**
    - **Property 11: 다층 LSTM 지원**
    - **검증: 요구사항 4.3**

- [ ] 7. 모델 학습 파이프라인 구현
  - [ ] 7.1 ModelTrainer 클래스 구현
    - 학습 에폭 메서드 작성
    - 검증 에폭 메서드 작성
    - 조기 종료 로직 구현
    - 체크포인트 저장/로드 메서드 작성
    - _요구사항: 5.1, 5.2, 5.3, 5.4, 5.5, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_
  
  - [ ] 7.2 GPU 지원 추가
    - 장치 감지 로직 구현
    - 모델 및 데이터 장치 이동
    - CPU 폴백 처리
    - _요구사항: 13.1, 13.2, 13.3, 13.4, 13.5_
  
  - [ ]* 7.3 학습 파이프라인 단위 테스트 작성
    - 조기 종료 로직 테스트
    - 체크포인트 저장 테스트
    - GPU/CPU 전환 테스트
    - _요구사항: 6.1, 6.2, 6.3_
  
  - [ ]* 7.4 모델 저장-로드 속성 테스트 작성
    - **Property 13: 모델 저장-로드 라운드트립**
    - **검증: 요구사항 6.6, 12.3**

- [ ] 8. 모델 평가 및 메트릭 구현
  - [ ] 8.1 Evaluator 클래스 구현
    - R², MAE, RMSE, MAPE 계산 메서드
    - 전체 평가 메서드 작성
    - 스케일 역변환 통합
    - _요구사항: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_
  
  - [ ]* 8.2 평가 메트릭 단위 테스트 작성
    - 알려진 입력/출력으로 각 메트릭 검증
    - MAPE 0으로 나누기 처리 테스트
    - _요구사항: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 9. 결과 시각화 구현
  - [ ] 9.1 Visualizer 클래스 구현
    - 학습 곡선 플롯 메서드
    - 예측 vs 실제 플롯 메서드
    - 잔차 플롯 메서드
    - 한글 폰트 설정
    - _요구사항: 10.1, 10.2, 10.3, 10.6_
  
  - [ ]* 9.2 시각화 단위 테스트 작성
    - 플롯 파일 생성 확인
    - 저장 경로 검증
    - _요구사항: 10.4, 10.5_

- [ ] 10. 체크포인트 - 핵심 컴포넌트 검증
  - 모든 테스트가 통과하는지 확인
  - 간단한 더미 데이터로 전체 파이프라인 실행
  - 질문이 있으면 사용자에게 문의

- [ ] 11. 메인 학습 스크립트 작성
  - [ ] 11.1 Q_in 예측 모델 학습 스크립트
    - 하이퍼파라미터 설정
    - 데이터 로딩 및 전처리
    - 모델 초기화 및 학습
    - 평가 및 결과 저장
    - _요구사항: 8.1, 9.1, 11.1-11.9_
  
  - [ ] 11.2 TMS 지표 예측 모델 학습 스크립트
    - 각 TMS 지표별 모델 학습 루프
    - 모델 식별자 관리
    - 결과 통합 및 저장
    - _요구사항: 8.2, 9.2, 9.3, 9.4, 9.5_

- [ ] 12. 예측 서비스 구현
  - [ ] 12.1 PredictionService 클래스 구현
    - 모델 로딩 메서드
    - 입력 전처리 메서드
    - 배치 예측 메서드
    - 스케일 역변환 통합
    - _요구사항: 8.1, 8.2, 8.3, 8.6, 12.1, 12.2, 12.3, 12.4_
  
  - [ ]* 12.2 예측 서비스 단위 테스트 작성
    - 모델 로딩 테스트
    - 전처리 일관성 테스트
    - 배치 예측 테스트
    - _요구사항: 8.1, 8.2, 8.3_

- [ ] 13. 오류 처리 강화
  - [ ] 13.1 모든 컴포넌트에 오류 처리 추가
    - 설명적인 오류 메시지 작성
    - 하이퍼파라미터 검증 추가
    - 파일 I/O 오류 처리
    - _요구사항: 14.1, 14.2, 14.3, 14.4, 14.6_
  
  - [ ]* 13.2 오류 처리 단위 테스트 작성
    - 잘못된 입력 테스트
    - 유효하지 않은 하이퍼파라미터 테스트
    - 파일 누락/손상 테스트
    - _요구사항: 14.1, 14.2, 14.3, 14.4, 14.5_

- [ ] 14. 통합 테스트 및 성능 검증
  - [ ]* 14.1 전체 파이프라인 통합 테스트 작성
    - 데이터 로딩부터 예측까지 전체 워크플로우 테스트
    - 다중 타겟 모델 학습 테스트
    - _요구사항: 9.1, 9.2, 9.3, 9.4, 9.5_
  
  - [ ]* 14.2 성능 목표 검증 테스트 작성
    - Q_in 예측 R² ≥ 0.95 검증
    - TMS 지표 예측 R² ≥ 0.90 검증
    - _요구사항: 8.4, 8.5_

- [ ] 15. 문서화 및 사용 예제
  - [ ] 15.1 Jupyter 노트북 작성
    - 데이터 로딩 및 탐색 예제
    - 모델 학습 예제
    - 예측 및 시각화 예제
    - 하이퍼파라미터 튜닝 가이드
    - _요구사항: 11.1-11.9_
  
  - [ ] 15.2 README 작성
    - 프로젝트 개요
    - 설치 방법
    - 사용 방법
    - 디렉토리 구조 설명

- [ ] 16. 최종 체크포인트 - 전체 시스템 검증
  - 모든 테스트가 통과하는지 확인
  - 실제 데이터로 전체 파이프라인 실행
  - 성능 목표 달성 확인
  - 질문이 있으면 사용자에게 문의

## 참고사항

- `*` 표시가 있는 작업은 선택 사항이며, 빠른 MVP를 위해 건너뛸 수 있습니다
- 각 작업은 특정 요구사항을 참조하여 추적 가능성을 보장합니다
- 체크포인트는 점진적 검증을 보장합니다
- 속성 테스트는 보편적 정확성 속성을 검증합니다
- 단위 테스트는 특정 예제 및 엣지 케이스를 검증합니다
